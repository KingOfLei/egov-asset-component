/**
 * 福建博思软件 1997-2017 版权所有
 * Auto generated by Bosssoft Studio version 1.0 beta
 * 2017年10月25日 下午3:30:24
 */
package com.bosssoft.egov.asset.ext.service.impl;

import org.springframework.stereotype.Service;

import com.bosssoft.egov.asset.ext.cache.AssetGridCacheManager;
import com.bosssoft.egov.asset.ext.entity.AssetGridCfg;
import com.bosssoft.egov.asset.ext.service.AssetGridCfgService;
import com.bosssoft.egov.asset.ext.utils.AssetGridExtCacheUtil;
import com.bosssoft.platform.page.utils.StringUtil;
import com.bosssoft.platform.runtime.web.response.AjaxResult;

/**
 * 类说明:
 *
 * <pre>
 * 修改记录：
 * 修改日期　　　修改人　　　修改原因
 * 2017年10月25日  chenzhibin  新建
 * </pre>
 */
@Service
public class AssetGridCfgServiceImpl implements AssetGridCfgService {

	@Override
	public AssetGridExtCacheUtil<AssetGridCfg> getGridCfgByUser(AssetGridCfg grid) {
		// 优先从缓存中读取网格配置，若缓存中没有该网格数据在从数据库获取到缓存然后返回
		return AssetGridCacheManager.getInstance().getGridCfg(grid);
	}
	
	@Override
	public AjaxResult saveGridCfg(AssetGridCfg grid, String type) {
		AjaxResult result = new AjaxResult(AjaxResult.STATUS_ERROR, "");
		
		String msg = validateGridCfg(grid);
		if(!StringUtil.isEmpty(msg)){
			result.setMessage(msg);
			return result;
		}
		
		if(grid.getColumns() == null || grid.getColumns().size() == 0){
			result.setMessage("显示列为空，请设置显示列！");
			return result;
		}
		
		AssetGridCfg gr = AssetGridCacheManager.getInstance().putGridCfg(grid, type);
		result.setData(gr);
		
		result.setStatusCode(AjaxResult.STATUS_SUCCESS);
		return result;
	}
	
	@Override
	public AjaxResult deleteGridCfg(AssetGridCfg grid) {
		AjaxResult result = new AjaxResult(AjaxResult.STATUS_ERROR, "");
		
		String msg = validateGridCfg(grid);
		if(!StringUtil.isEmpty(msg)){
			result.setMessage(msg);
			return result;
		}
		
		try{
			AssetGridCacheManager.getInstance().removeGridCache(grid);
		} catch(Exception e){
			result.setMessage("网格重构失败！");
			return result;
		}
		
		result.setStatusCode(AjaxResult.STATUS_SUCCESS);
		
		return result;
	}
	
	private String validateGridCfg(AssetGridCfg grid) {
		if(grid == null || StringUtil.isEmpty(grid.getGridId())){
			return "网格配置不存在！";
		}
		
		if(StringUtil.isEmpty(grid.getUserCode())){
			return "用户信息不存在！";
		}
		return null;
	}
}
