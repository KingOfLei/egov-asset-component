/*!
 * 扩展jCarouselLite插件
 *     1.实现点击图片生成遮罩层预览
 *     2.可设置控件宽高
 *     3.扩展刷新方法: 参数 insertOpts 为,初始化参数
 *     4.扩展预览图文件路径自定义: openPreview: { setPreviewRule: function(){}}
 * $('#initPreview').galleryPreview('refresh',insertOpts);
 * author: zxy
 * date: 2017.6.13
 * update: 2017.7.3
 * version: 2.0
 * 扩展插件来源于：jCarouselLite
 */
(function(a){a.fn.galleryPreview=function(c,g){var e={};var h=this,b={},f;var d=typeof c;e.initPlugIn=function(i,j){h.each(function(){var l=a(this);var k={};k.init=function(){var m=a.extend(true,{},a.fn.galleryPreview.options.jclOpts,i.jclOpts);this.createLayout(m);this.defaultInit(m,i.openPreview)};k.createLayout=function(m){var s="";var q=m.imgSize.width?"width:"+m.imgSize.width+"px;":"",r=m.imgSize.height?"height:"+m.imgSize.height+"px;":"";var p='style="'+q+r+'"';if(i.imgs.length===0){i.imgs.push({src:i.defaultImg,title:"暂无图片"})}for(var o=0;o<i.imgs.length;o++){var t=i.imgs[o].title?i.imgs[o].title:"";s+='<li><img src="'+i.imgs[o].src+'" '+p+' title="'+t+'" alt="图片加载失败" /></li>'}var n='<div class="jcl">                        <div class="container">                            <a class="prev">&lsaquo;</a>                            <div class="carousel">                                <ul>'+s+'</ul>                            </div>                            <a class="next">&rsaquo;</a>                            <div class="clear"></div>                        </div>                    </div>';l.append(n)};k.defaultInit=function(m,p){var o={btnNext:l.find(".container .next"),btnPrev:l.find(".container .prev"),circular:true};var n=a.extend(true,{},o,m?m:{});l.find(".carousel").jCarouselLite(n);p?k.openPreview(n,p):undefined;l.find(".container").find("a").css("margin-top",(parseInt(l.find(".container .carousel").height())-30)/2)};k.openPreview=function(m,n){l.find(".carousel img").on("click",function(o){o.stopPropagation();k.creatMask(a(this),m,n)}).css("cursor","pointer")};k.creatMask=function(o,n,p){var m='<div class="jcl-mask">                        <div class="jcl-mask-cell">                            <div class="jcl-mask-center">                            	<img src="" alt="图片加载失败" />                            </div>                            <div class="jcl-mask-left switch-btn"></div>                            <div class="jcl-mask-right switch-btn"></div>                            <div class="jcl-mask-close"></div>                        </div>                    </div>';a("body").append(m);k.bindMaskBtnEven(n);k.loadPreviewImg({$targetLi:o.parents("li"),switchImgOpts:{type:"both",circular:n.circular},preview:i.openPreview})};k.bindMaskBtnEven=function(m){a(".jcl-mask-close").on("click",function(){k.closeMask()});a(".jcl-mask-left").on("click",function(){k.switchImgs({type:"prev",circular:m.circular})});a(".jcl-mask-right").on("click",function(){k.switchImgs({type:"next",circular:m.circular})})};k.switchImgs=function(r){var q=l.find('.carousel li[_select="true"]');var o,p,s,m,n;switch(r.type){case"prev":o=q.prev("li");s=a(".jcl-mask-right");m=a(".jcl-mask-left");n="last";break;case"next":o=q.next("li");s=a(".jcl-mask-left");m=a(".jcl-mask-right");n="first";break}k.loadPreviewImg({preview:i.openPreview,$targetLi:o,$show:s,switchImgOpts:r,$hide:m,$curLi:q,limit:n})};k.checkBoundary=function(p,o){var n,m;switch(o.type){case"prev":n=p.prev("li");if(!o.circular&&n.length===0){a(".jcl-mask-left").hide()}break;case"next":n=p.next("li");if(!o.circular&&n.length===0){a(".jcl-mask-right").hide()}break;case"both":o.type="prev";k.checkBoundary(p,o);o.type="next";k.checkBoundary(p,o);break}};k.loadPreviewImg=function(o){var n=a(".jcl-mask-center>img"),m=typeof o.preview=="object"?o.preview.setPreviewRule(o.$targetLi.find("img").attr("src")):o.$targetLi.find("img").attr("src");if(o.$targetLi.length>0){n.attr("src",m);o.$targetLi.attr("_select",true).siblings("li").attr("_select",false);o.$show?o.$show.show():"";k.checkBoundary(o.$targetLi,o.switchImgOpts)}else{o.$targetLi=o.$curLi.parent().find(">li:"+o.limit);n.attr("src",m);o.$targetLi.attr("_select",true).siblings("li").attr("_select",false);if(n.attr("src")==m){k.switchImgs(o.switchImgOpts)}}k.setImgParentHeight()};k.setImgParentHeight=function(){a(".jcl-mask-center>img").load(function(){if(a(".jcl-mask-center>img").height()>=a(".jcl-mask").height()){a(".jcl-mask-center").height(a("body").height())}else{a(".jcl-mask-center").height("auto")}}).each(function(){if(this.complete){a(this).load()}})};k.closeMask=function(){a(".jcl-mask").remove()};if(j){h.children().remove()}k.init()})};if(d==="object"){b=a.extend(true,{},a.fn.galleryPreview.options,c||{})}else{if(d==="string"&&c==="refresh"){f="refresh";b=a.extend(true,{},a.fn.galleryPreview.options,g||{})}}return e.initPlugIn(b,f)};a.fn.galleryPreview.options={imgs:[],jclOpts:{imgSize:{width:100,height:80}},openPreview:true,defaultImg:""}})(jQuery);