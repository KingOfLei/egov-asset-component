/*******************************************************************************
 * 福建博思软件1997-2017 版权所有
 * 
 * Auto generated by Bosssoft Studio version 1.0 beta
 * 2018年1月15日下午4:39:52
 *******************************************************************************/
package com.bosssoft.egov.asset.di.controller;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import com.bosssoft.egov.asset.aims.api.org.entity.AimsBasicOrg;
import com.bosssoft.egov.asset.aims.api.org.service.OrgService;
import com.bosssoft.egov.asset.basic.BaseController;
import com.bosssoft.egov.asset.di.entity.AssetDiTask;
import com.bosssoft.egov.asset.di.entity.AssetDiTaskDataSource;
import com.bosssoft.egov.asset.di.entity.AssetDiTaskDetails;
import com.bosssoft.egov.asset.di.service.AssetDiTaskDataSourceService;
import com.bosssoft.egov.asset.di.service.AssetDiTaskDetailsService;
import com.bosssoft.egov.asset.di.service.AssetDiTaskService;
import com.bosssoft.platform.runtime.web.binding.annotation.AjaxResponseBody;
import com.bosssoft.platform.ui.tags.UIConst;

/**
 * @ClassName	类名：AssetDiController
 * @Description	功能说明：数据导入导出接口控制层
 * <pre>
 * @date		创建日期：2018年1月15日
 * @author		创建人：chenzhibin
 * @version		版本号：V1.0
 * <pre>
 *-------------------修订记录---------------------
 */
@Controller
@RequestMapping("egov/asset/di")
public class AssetDiController extends BaseController {
	
	@Autowired
	private AssetDiTaskService taskService;
	
	@Autowired
	private AssetDiTaskDetailsService taskDetailsService;
	
	@Autowired
	private AssetDiTaskDataSourceService dataSourceService;
	
	@Autowired
	@Qualifier(OrgService.REFERENCE_BEAN_NAME)
	private OrgService orgService;

	@RequestMapping(value="showIndex.do", name="导入导出入口")
	public String showIndex(Model model){
		return "egov/asset/di/assetDiIndex.ui";
	}
	
	@RequestMapping(value="showDataSourceCfg.do", name="显示数据源配置")
	public String showDataSourceCfg(String type, String groupId, Model model){
		Map<String, Object> data = new HashMap<String, Object>();
		data.put("type", type);
		data.put("groupId", groupId);
		model.addAttribute(UIConst.UIPAGEMODEL, data);
		return "egov/asset/di/dataSourceCfg.ui";
	}
	
	@RequestMapping(value="showOrgCompare.do", name="显示单位对照")
	public String showOrgCompare(Model model){
		return "egov/asset/di/orgCompare.ui";
	}
	
	@ResponseBody
	@RequestMapping(value="getDiTaskList.do", name="获取数据接口列表")
	@AjaxResponseBody
	public List<AssetDiTask> getDiTaskList(){
		return taskService.getAssetDiTaskList(null);
	}
	
	@ResponseBody
	@RequestMapping(value="getDiTaskDetailsList.do", name="获取数据接口任务明细列表")
	@AjaxResponseBody
	public List<AssetDiTaskDetails> getDiTaskDetailsList(String taskId){
		AssetDiTaskDetails assetDiTaskDetails = new AssetDiTaskDetails();
		assetDiTaskDetails.setTaskId(taskId);
		return taskDetailsService.getAssetDiTaskDetailsList(assetDiTaskDetails);
	}
	
	@ResponseBody
	@RequestMapping(value="getDataSourceList.do", name="获取数据源配置列表")
	public List<AssetDiTaskDataSource> getDataSourceList(){
		return dataSourceService.getDataSourceList();
	}
	
	/**
     * 
     * <p>功能说明：根据编码批量生成下级编码
     * </p>
     * <p>参数说明：
     * @param orgCodes 编码列表
     * @return
     * </p>
     *
     * @date	创建时间：2018年1月23日
     * @author	作者：chenzhibin
     */
    @RequestMapping(value="batchGenerateOrgCode.do")
    @ResponseBody
    public List<Map<String, Object>> batchGenerateOrgCode(List<String> orgCodes){
    	List<Map<String, Object>> orgs = new ArrayList<Map<String, Object>>();
    	for(String orgCode : orgCodes){
    		AimsBasicOrg aimsBasicOrg = orgService.queryOneByCode(orgCode);
    		if(aimsBasicOrg != null){
    			orgs.add(orgService.queryMaxSubOrgCode(aimsBasicOrg));
    		}
    	}
    	
    	return orgs;
    }
    
    @RequestMapping(value="showUpReport.do", name="显示上报界面")
    public String showUpReport(Model model){
    	return "egov/asset/di/upReport.ui";
    }
}
