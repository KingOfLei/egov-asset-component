/**
 * * Auto generated by Bossssoft Studio version 1.0 beta
 * Fri Dec 23 13:02:08 CST 2016
 */
//define(['引入外部js模块或控件'],function('引入外部js或控件的别名'){})
define(
		[ 
		  "app/widgets/window/app-dialog",
		  "app/app-pagebase",
		  "resources/egov/js/ext/js/etl/etl-helper"],
		function(Dialog,PageBase,etlHelp) {
		   var ImpFileDlg = PageBase.extend({
		             //类初始化
		            initialize : function() {
						ImpFileDlg .superclass.initialize.call(this);
					},
					//存储弹出窗口回调
					showPageCallBack:null,
					//当前窗口状态
					indexAction:null,
					//存放通知公告内容
					content:null,
					//控件监听事件  格式：#控件id#:{事件名:事件方法}
					listeners:{
						//正文上传失败提示：
						etlImpFile:{
							uploadError:function(obj){
								 if($.type(obj)!=='object'){
				                        return;
				                    }
				                    if($.type(obj.responseText) === 'undefined' || obj.responseText.indexOf('File upload failed,maybe file is too large!') >=0){
				                        $messager.warn('上传失败，文件大小不可超过5M！');
				                    }else{
				                        $messager.warn('上传失败！');
				                    }
							},
							uploadSuccess:function(){
								
							},
							afterDelete:function(){
								
							}
						},
						impFile_ok:{
							click:function(){
								//判断文件列表个数
								var fileList = $A('#etlImpFile').upload('getFileList');
								if(fileList.length >0 ){
									var configCode = $a('#configCode').val();//配置编码
									var templeteName = $a('#templeteName').val();//导入模版
									var ids = [];
									for(var i = 0;i < fileList.length;i++){
										ids.push(fileList[i].id);
									}
									etlHelp.impFileTask({
										data:{
											configCode:configCode,
											fileIds:ids
										},
										waitMsg:'正在导入,请稍等...',
										tipMsg:templeteName+'导入',
										successCallback:function(data){
											//清空列表
											for(var i = 0; i<fileList.length; i++){
												$A('#etlImpFile').upload('_deleteFile',$("[fileid='" + fileList[i].id + "']") );
											}
											
										},
										errorCallback:function(data){
											//清空列表
											//清空列表
											for(var i = 0; i<fileList.length; i++){
												$A('#etlImpFile').upload('_deleteFile',$("[fileid='" + fileList[i].id + "']") );
											}
										}
									});
								} else {
									$messager.warn('请先上传导入文件！');
								}
							}
						}
					},
					//下载
					downloadTemplte:function(url){
						url = url.replace("|","/");
						$.uiExtend({type:'download',url:url,options:{onFail:function(){
							$a.assetMsg.warn('无模版可提供下载!');
						}}});
					},
					//页面加载后初始化
					initPage:function(data){
						var self = ImpFileDlg.getInstance();
						if(!data.__flag__){
							$a.assetMsg.warn(data.__msg__);
							$.closeDialog();
							return;
						}
					},
					//控件属性重置
					initUIExtConfig : function() {
						this.uiExtConfig={
							//格式 #控件id#:function(控件属性集类){ config.setAttr("控件属性名","属性值"),// 网格，下拉网格，特殊设置config.getColumn("网列id").setAttr("列属性名","列属性值")config.getButton("网格内包含的按钮id").setAttr("handler","点击事件")  }
								
						
						}
					}

		 });
		   //创建窗体类单例
			 ImpFileDlg.getInstance=function(){
		     if (!this.instance){
		    	 this.instance =new ImpFileDlg();
		     }
		     return this.instance;
		 }
		
		 return  ImpFileDlg.getInstance();
	   })