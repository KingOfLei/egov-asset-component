/**
 * * Auto generated by Bossssoft Studio version 1.0 beta
 * Fri Dec 23 12:36:43 CST 2016
 */
//define(['引入外部js模块或控件'],function('引入外部js或控件的别名'){})
define(
		[ 
		  "app/widgets/window/app-dialog",
		  "app/app-pagebase","resources/egov/js/asset/cms/notice/cmsnotice_add.js"],
		function(Dialog,PageBase,dlg) {
		   var CmsNoticeModel = PageBase.extend({
		             //类初始化
		            initialize : function() {
						CmsNoticeModel.superclass.initialize.call(this);
					},
					//控件监听事件  格式：#控件id#:{事件名:事件方法}
					listeners:{
					    //新增按钮事件
						cmsNoticePage_btnAdd:{
							click: function(){
							dlg.showPage(dlg.ACTION.ADD,null,function(){
								 CmsNoticeModel.getInstance().refreshData();
							})
							}
						},
						//新增按钮事件
						cmsNoticePage_btnQuery:{
							click:function(){
								$("#cmsNoticePage_query").xquery("toggle");
							}
						},
						cmsNoticePage_grid:{
							onDblClickCell:function(rowData,rowIndex){
								$.ajax({
									url : "egov/asset/cms/notice/updateReadRecord.do",
									type:'POST',	
									data:{
										id:rowData.id
									},
									dataType:"json",
									success:function(data){
									
									}
								});
								CmsNoticeModel.getInstance().showViewPage(rowData);
							},
							onLoadSuccess:function(data){
								$.uiExtend({
									type:'grid-rowformatter',							
							        $grid:$('#cmsNoticePage_grid'),
							        options:{
							        } // 无配置项时也需传空对象
			                    });
							}
						},
						//设置首页弹窗
						cmsNoticePage_setDialog:{
							click: function(){
								var rows = $("#cmsNoticePage_grid").grid("getSelections");
								//是否共享 或者单独设置(重置)
								/* 设置首页弹窗分为两种情况*/
								/* 1.如果没有选中任何公告，则弹出是否清除已有的配置信息*/
								if(rows == null || rows.length == 0){
									$A.assetMsg.confirm('确定清除已有的配置吗？',{
										ok:function(){
											CmsNoticeModel.getInstance().saveSetIndexConfig([],true); 
				                            return;
										}
									});
								}else{
									/*2.如果选中公告后点击，则弹出是重置还是追加 */
									var options ={};
									var button,msg;
									msg = "确定设置弹窗信息吗？",
							    	button=[ { name: '重置', 
							    		       callback: function(){
							    		    	   if(rows.length > 10){
							    		    		   $A.assetMsg.warn("最多只能选择10条记录!");
														return;
							    		    	   }
							    		    	   CmsNoticeModel.getInstance().saveSetIndexConfig(rows,true); 
					                               return;
							    		       }},
								             { name: '追加',
							    		       callback: function (){
							    		    	   if(rows.length > 10){
							    		    		   $A.assetMsg.warn("最多只能选择10条记录!");
														return;
							    		    	   }
							    		           CmsNoticeModel.getInstance().saveSetIndexConfig(rows,false); 
												   return;
							    		    	}},
								             { name: '取消',
							    		       focus: true,
							    		       callback: function (){ 
							    		       }}
								        ];
									options={msg:msg,button:button};
									$A.assetMsg.info(options.msg,{
			                        	ok:false,
			                        	icon:'question',
			                            button:options.button
			                        });
						        	
								}	
								
								/*$A.assetMsg.confirm("确定设置弹窗信息吗",{
			                            okVal:'是(重置)',
			                            ok2Val:'是(追加)',
			                            cancelVal:'取消',
			                            ok:function () {
			                            	CmsNoticeModel.getInstance().saveSetIndexConfig(rows,true); 
			                                return;
			                            },
										ok2:function () {
			                            	CmsNoticeModel.getInstance().saveSetIndexConfig(rows,false); 
											return;
										},
			                            icon:'question',
			                            cancel:function () {
			                            	$.closeDialog();
			                            }
			                        })*/
							}
						}
					},
					//页面加载后初始化
					initPage:function(){
						//显示
						var noticeType = $a('#noticeType').val();
						var timeType = $a('#timeType').val();
						var titile = '';
						if(noticeType == '1'){
							//公告
							titile = '公告';
							$A('#cmsNoticePage_grid').grid('hideColumn', 'wenHao');							
						} else if (noticeType == '5'){
							//制度
							titile='制度';
							$A('#cmsNoticePage_grid').grid('showColumn', 'wenHao');
							$A('#cmsNoticePage_grid').grid('hideColumn', 'topExpir');
						}
			            $A("#cmsNoticeViewPage_panel_bottom").find('div.grid-header-title').find('span').first().html(titile);																	
						$("#cmsNoticePage_grid").grid("setFixedParameter",{searchType:noticeType,timeType:timeType});
						$("#cmsNoticePage_query").xquery("toggle");	
						$("#cmsNoticePage_query").xquery("quickQuery");
					},
					//格式化状态
					showFormatterStatus:function(cellvalue){
						if(cellvalue == "0") 
							return "未审核";
						else if(cellvalue == "1"){
							return "审核未发布";
						} else if (cellvalue == "2"){
							return "已发布";
						}
						return "";
					},
					//格式化类型
					showFormatterType : function(cellvalue){
						if(cellvalue == "0") 
							return "通知";
						else if(cellvalue == "1"){
							return "公告";
						} else if(cellvalue == "5"){
							return "制度";
						}
						return "";
					},
					//显示查看业
					showViewPage:function(data,e){
					    var _self=this;
						dlg.showPage(dlg.ACTION.VIEW,data,function(){
							 CmsNoticeModel.getInstance().refreshData();
						});
					},
					refreshData:function(){
						$("#cmsNoticePage_grid").grid("reload");
					},
					//显示编辑业
					showEditPage:function(data,e){
						 var _self=this;
						dlg.showPage(dlg.ACTION.EDIT,data,function(){
							 CmsNoticeModel.getInstance().refreshData();
						});
					},
					doDeleteData:function(data,e){
						 var _self=this;
						 $A.messager.confirm("确认删除当前记录吗？", {
								okCall : function() {
									var url = "egov/asset/cms/notice/doDelete.do";
									$app.ajax.ajaxCall({
										url : url,
										data : data,
										callback : function() {
											$A.messager.correct("删除成功");
											 CmsNoticeModel.getInstance().refreshData();
										}
									});
								}
						 });
					},
					//设置弹窗信息
					saveSetIndexConfig:function(rows,reset){
						var ids = [];
						for (var i = 0; i < rows.length;i++) {
							ids[i] = rows[i].id;
						}
						$app.ajax.ajaxCall({
							url : "egov/asset/cms/notice/updateIndexNoticeConfig.do",
							data : {
								id:JSON.stringify(ids),
								reset:reset
							},
							callback : function(json) {
								if(json.tag == true){
									$A.assetMsg.success(json.msg);
								}else{
									$A.assetMsg.warn(json.msg);
								}
							}
						})
					},
					
					//控件属性重置
					initUIExtConfig : function() {
					    var _self=this;
						this.uiExtConfig={
							//格式 #控件id#:function(控件属性集类){ config.setAttr("控件属性名","属性值"),// 网格，下拉网格，特殊设置config.getColumn("网列id").setAttr("列属性名","列属性值")config.getButton("网格内包含的按钮id").setAttr("handler","点击事件")  }
							cmsNoticePage_grid:function(config){
								config.getButton("cmsNoticePage_grid_btnEdit").setAttr("handler",_self.showEditPage);
								config.getButton("cmsNoticePage_grid_btnView").setAttr("handler",_self.showViewPage);
								config.getButton("cmsNoticePage_grid_btnDel").setAttr("handler",_self.doDeleteData);
							}
						
						}
					}

		 });
		 CmsNoticeModel.getInstance=function(){
		     if (!this.instance){
		    	 this.instance =new CmsNoticeModel();
		     }
		     return this.instance;
		 }
		
		 return  CmsNoticeModel.getInstance();
	   })