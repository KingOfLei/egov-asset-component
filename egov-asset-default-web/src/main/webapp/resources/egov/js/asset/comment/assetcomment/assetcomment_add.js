/**
 * * Auto generated by Bossssoft Studio version 1.0 beta
 * Wed May 24 11:21:09 CST 2017
 */
//define(['引入外部js模块或控件'],function('引入外部js或控件的别名'){})
define(
		[ 
		  "app/widgets/window/app-dialog",
		  "app/app-pagebase"],
		function(Dialog,PageBase) {
		   var AssetCommentDlg = PageBase.extend({
		             //类初始化
		            initialize : function() {
						AssetCommentDlg .superclass.initialize.call(this);
					},
					ACTION:{
						ADD:"ADD",
						VIEW:"VIEW"
					},
					//存储弹出窗口回调
					showPageCallBack:null,
					//当前窗口状态
					indexAction:null,
					//控件监听事件  格式：#控件id#:{事件名:事件方法}
					listeners:{
				         	//新增并保存
					  		assetCommentPage_saveaddBtn : {
								click : function() {
									 var self=AssetCommentDlg.getInstance();
									self.doSave({isSaveAdd:true})					
								}
							},
							//新增
							assetCommentPage_addBtn : {
								click : function() {
								  $A("#assetCommentPage_form").clearFormEditorValue();
								}
							},
							//编辑
							assetCommentPage_editorBtn : {
								click : function() {
									 var self=AssetCommentDlg.getInstance();
									 self.indexAction=self.ACTION.EDIT;
									 $A("#assetCommentPage_editorBtn").hide();
									 $A("#assetCommentPage_saveBtn").show();
									 $A("#assetCommentPage_form").toggleFormState("edit");					
							    }
							},
							//保存
							assetCommentPage_saveBtn : {
								click : function() {
									//关闭窗体
									$.closeDialog();
								}
							},
							//关闭
							assetCommentPage_closeBtn : {
								click : function() {
									$A('#assetCommentVal').val('');
									$.closeDialog();
								}
							},
							//返回
							assetCommentPage_close : {
								click : function() {
									$A('#assetCommentVal').val('');
									$.closeDialog();
								}
							}
					},
					loadData:function(param,callback){
						var url="egov/asset/comment/assetcomment/getAssetComment.do"
												$.ajaxCall({
											url : url,
											data : param,
											callback : function(data) {
												$A("#assetCommentPage_form").refreshFormData(data);
												if (callback){
													callback();
												}
											}
						})
					},
					//保存数据cofig:{isSaveAdd:"保存并新增",isSaveClose:"保存关闭",isSaveView:"保存查看"}可自行扩展
					doSave:function(config,callback){
						var url="";
						if (this.indexAction == this.ACTION.ADD) {
							url="egov/asset/comment/assetcomment/doInsert.do"
						}
						if (this.indexAction == this.ACTION.EDIT) {
							url="egov/asset/comment/assetcomment/doUpdate.do"
						}
						 var _self=AssetCommentDlg.getInstance();
						$A('#assetCommentPage_form').sumbitAllComp({
									                     submitMode : 'all',
									                     url : url,
									                     callback : function(json) {
									                     	if (config.isSaveAdd){
									                     	  $A("#assetCommentPage_form").clearFormEditorValue();              	 
															  _self.indexAction=_self.ACTION.ADD;
									                     	}else if (config.isSaveClose){
									                     	 									                         $.closeDialog();
									                         _self.indexAction="";
									                     	}else if (config.isSaveView){
									                     		$A("#assetCommentPage_form").toggleFormState("view");
									                     		$A("#id").textbox("readonly",true);					
							                                     $A("#rgnId").textbox("readonly",true);					
							                                     $A("#rgnCode").textbox("readonly",true);					
							                                     $A("#rgnName").textbox("readonly",true);					
							                                     $A("#orgId").textbox("readonly",true);					
							                                     $A("#orgCode").textbox("readonly",true);					
							                                     $A("#orgName").textbox("readonly",true);					
							                                     $A("#userId").textbox("readonly",true);					
							                                     $A("#userCode").textbox("readonly",true);					
							                                     $A("#userName").textbox("readonly",true);					
							                                     $A("#str01").textbox("readonly",true);					
							                                     $A("#str02").textbox("readonly",true);					
							                                     $A("#str03").textbox("readonly",true);					
							                                     $A("#status").textbox("readonly",true);					
							                                     							                                     _self.indexAction=_self.ACTION.VIEW;
									                     	}
									                     	if (_self.showPageCallBack){
									                     		_self.showPageCallBack();
									                     	}
									                     }
							                         });		
					},
					//外部调用方法
					//data = {
					// bizId:'',业务id
					// action:'',编辑类型
					// textVal:'' 默认意见值
		             //}
					showCommentPage:function(data,callback){
						 this.showPageCallBack=callback||function(){};
						 var self=this;
						 var options = {
									url : "egov/asset/comment/showAdd.do",
									dialogId : "CommentShow",
									title : "意见",
									width : 800,
									height : 600,
									wrapper : true,
									hasheader : false,
									params:{
										bizId:data.bizId,
										action:(data.action == undefined) ? self.ACTION.VIEW : data.action,
										textVal:(data.textVal == undefined) ? "同意" : data.textVal
									},
									reload : true,
									beforeClose:function(obj,dig,event){
										var content = $A('#assetCommentVal').val();
										self.showPageCallBack(content);
									},
									onPageLoad : function(obj) {
										
									}
								};
						 $.openModalDialog(options);
					},
					beforePageInit:function(page,data){
						var _self = AssetCommentDlg.getInstance();
						var viewStatus = data.params.action;
						if(viewStatus === _self.ACTION.VIEW){
							//隐藏意见框 显示底部返回按钮 重置高度
							var height = $a('#assetCommentPage_panel_north',page).height();
                            $a('#assetCommentPage_panel_north',page).remove();
                            $a('#assetCommentPage_panel',page).parent().css("top","0px");
//                            $a('#assetCommentPage_panel').css('height',);
                            var vHeight = $A('#commentlist_panel_center_tabs',page).height();
                            $a('#commentlist_panel_center_tabs',page).remove();                            
                            $a('#commentlist_panel_center_tab',page).parent().css("top","0px");
                            $a('#commentlist_panel_center_tab',page).css("height",$a('#commentlist_panel_center_tab').height()+height + vHeight);
                            $a('#assetCommentPage_panel',page).css("height",$a('#assetCommentPage_panel').height()+height + vHeight);
                            
                            //显示底部按钮
                            $a('#assetCommentBtns',page).parent().show();
						}
					},
					initComponent:function(data){
						//意见框
						var _self = AssetCommentDlg.getInstance();
						var viewStatus = data.action;
						if(!(viewStatus === _self.ACTION.VIEW)){
							$.uiExtend({
						        type:'form-textarea',						// (*必传)扩展插件类型
								$parentObj:$('#assetCommentPage_form'),				// (*必传，JQ对象)需插入的父级表单JQ对象
						        options:{
						    		textareaId:'assetCommentVal',	// (*必传)文本域ID
						    		textareaName:'意见',					// (非必传)文本域label标题
						    		textVal:data.textVal,								// (非必传)文本域返回值
						    		height:120,								// (非必传)文本域高度
						    		disabled: false,						// (非必传)文本域是否只读
						        	dblclick:true,							// (非必传)选项列表是否支持双击选择，默认为 true
						        	loadName:'常用意见',
						        	loadUrl:'egov/asset/comment/getAssetCommentList.do',								// (*必传)加载选项请求地址
									loadParams:{},							// (非必传)加载选项请求参数，默认无参数
						        	addUrl:'egov/asset/comment/doInsert.do',								// (*必传)新增选项请求地址
									addParams:{
										
									},							// (非必传)新增选项请求参数，默认参数为文本域输入值
									addItemField:'content',					// (非必传)新增请求的文本域取值参数字段名，默认字段名为 content
									deleteUrl:'egov/asset/comment/doDelete.do',							// (*必传)新增选项请求地址
						        	deleteItemField:'id',					// (非必传)删除选项请求参数字段名，默认字段名为 id
						        	initialOpts:[
									     {
								        	 id:'1',
								        	 content:'同意',
								         },
								         {
								        	 id:'2',
								        	 content:'不同意',
								         }             
						        	]
						        }
						    });
						}
						//加载意见
					    var url = "egov/asset/comment/queryBizCommentList.do";
						$app.ajax.ajaxCall({
			                url: url,
			                data: {
			                	bizId:data.bizId
			                },
			                callback: function (data) {
			                	var list = [];
			                	var len = 0;
			                	for(var i=0;i<data.length;i++){
			                		var val = data[i];
			                		if(val.remark === '') continue;
			                		list[len] = {};
			                		list[len].content = val.taskName + "：" + val.operatorName + "，审批意见：" + val.remark;
			                		var date = val.operateDate.substr(0,4)+ "-" + val.operateDate.substr(4,2)+ "-" + val.operateDate.substr(6,2)+ " " + val.operateDate.substr(8,2)+ ":" + val.operateDate.substr(10,2)+ ":" +val.operateDate.substr(12,2);
			                		list[len].time = "时间：" + date;
			                		len++;
			                	}
			                	if(list.length <1){
			                		//无意见
			                		list[0] = {};
			                		list[len].content = "暂无意见";
			                		list[len].time = '';
			                	}
			                	$a("#commentlist_panel_center_tab").uiExtend({
		                            type:'listflow',
		                            name: 'time',
		                            time: 'content',
		                            data: list,
		                            completed: function () {
		                               
		                            }
		                         });
			                }
			             });
						//
						
					},
					//页面加载后初始化
					initPage:function(data){
						var _self = AssetCommentDlg.getInstance();
						_self.initComponent(data.params);
					},
					//控件属性重置
					initUIExtConfig : function() {
						this.uiExtConfig={
							//格式 #控件id#:function(控件属性集类){ config.setAttr("控件属性名","属性值"),// 网格，下拉网格，特殊设置config.getColumn("网列id").setAttr("列属性名","列属性值")config.getButton("网格内包含的按钮id").setAttr("handler","点击事件")  }
								
						
						}
					}

		 });
		   //创建窗体类单例
			 AssetCommentDlg.getInstance=function(){
		     if (!this.instance){
		    	 this.instance =new AssetCommentDlg();
		     }
		     return this.instance;
		 }
		
		 return  AssetCommentDlg.getInstance();
	   })